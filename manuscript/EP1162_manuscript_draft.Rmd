---
title: Analyses of 27 years of stand structure development and basal area growth response to a range of initial basal area density levels, 1992-2019 
author: "Mike Jull and Hardy Griesbauer"
date: "29/03/2020"
output:
  word_document:
    reference_docx: wordTemplate2.docx
  html_document:
    df_print: paged
csl: cjfr.csl
bibliography: ep1162Bib.bib
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,message=FALSE,warning=FALSE)

# Load libraries
library(tidyverse)
library(here)
library(lme4)
library(lmerTest)
library(broom)
library(MuMIn)
library(ggeffects)
library(car)
library(flextable)
library(captioner)
library(lsmeans)

# Load data
load(here::here("data","ep1162_Data.RData"))
load(here::here("data","ep1162_plotData.RData"))

# set up captions

# Code to create captions for tables
tableNums <- captioner(prefix = "Table")

# Code to create captions for figures
figNums <- captioner(prefix="Figure")

# Code to create captions for appendices
appNums <- captioner(prefix="Appendix")

# Set ggplot theme
theme_set(theme_bw())

# Some additional data prep

# set up diameter classes
diamClass=seq(from=7.5,to=95,by=5)
dat<- # assign variable
  dat %>% 
  mutate(DBH.class=cut(DBH,diamClass,ordered_result = TRUE,right=F))


```



# Methods

## Analysis

### Tree-level growth responses
To test the hypothesis that tree-level growth response over the 1992-2019 period varied with interactions between (i) tree basal area at the time of treatment (1992); (ii) residual basal area; and (iii) species, we fit linear mixed effects models with log-transformed 1992-2019 basal area increment as the response variable, and treatment, species and log-transformed 1992 basal area as interacting fixed effects, with plot as a random intercept effect.  We also fit a similar model with the 1992-2019 basal area increment expressed as a percentage of 1992 basal area.  Plots of residuals and fit lines with orginal data were examined to evaluate model goodness of fit.  Variance explained for each model are reported using the approach described in Nakagawa et al. [-@Nakagawa2013], as implemented in the MuMIn package for R [@add later].

We also examined how basal area increment at the tree-level varied over the four measurement periods, by fitting a similar model as described above, with an additional fixed effect of measurement period.  This allowed us to examine temporal changes in growth responses, including evaluating for a potential lag effect.


## Stand structure and growth dynamics

### Changes in tree density over time
We qualitatively assessed changes in tree density over time through density diagrams that displayed tree density (stems per hectare) by diameter class, faceted by measurement period, species and treatment unit.  The effects of tree density changes on basal area was also qualitatively evaluated by summarizing basal area per hectare by diameter class, species and treatment unit.

### Stand-level basal area and volume growth


#### Volume estimates
Tree volumes were estimated using species- and region-specific equations [@nigh2016] based on tree height and DBH.  We estimated tree heights by fitting diameter-height models developed separately for fir and spruce, and for each period.  Trees with broken tops were omitted from diameter-height models. 



# Results



### Tree-level growth responses
```{r tree-level growth responses}

# Let's filter only for trees that have measurements in 1992 and 2019 
treeList<- # assign variable
  dat %>% 
  filter(TreeID!="New") %>% #remove new trees
  mutate(TreeID=paste(Plot,TreeID,sep="-")) %>% # create unique treeID
  filter(Species %in% c("Sx","Bl")) %>% # filter birch and fdi out of dataset
  filter(Status=="Live") %>% # filter for live trees
  filter(Year %in% c(1992,2019)) %>% #filter for start and end dates
  group_by(TreeID) %>% 
  summarise(N=n()) %>% 
  filter(N==2) %>% #filter for trees with 5 measurements
  pull(TreeID)
  

# derive periodic increment (period diameter or basal area increment)
piDat<-
  dat %>% 
  mutate(TreeID=paste(Plot,TreeID,sep="-")) %>% # create unique treeID
  filter(TreeID %in% treeList) %>% 
  mutate(BA=(DBH/2/100)^2*pi) %>% # convert DBH to basal area
  dplyr::select(Plot,TreeID,Species,Year,BA) %>% 
  pivot_wider(names_from=Year,values_from=BA) %>% 
  mutate(PI=`2019`-`1992`) %>% # 
  filter(PI>0) %>% # one tree has a PI of 0, has to be removed
  mutate(PIpct=PI/`1992`*100) %>% # express periodic increment a a percentage
  dplyr::select(Plot,TreeID,Species,PI,PIpct,Init=`1992`) %>% 
  left_join(plotDat,by="Plot") %>% 
  mutate(BA.Target=paste("TU:",BA.Target,sep="")) # create facet column


# Create figures of raw data to put into Appendix
pi.Init.rawPlot<-  
  piDat %>% 
  ggplot(aes(x=log(Init),y=log(PI),color=Species))+
  geom_point()+
  geom_smooth(method="lm",se=FALSE,color="black")+
  facet_grid(Species~BA.Target)  +
   ylab("log(BA increase, m²)")+
  xlab("log(Tree BA in 1992, m²)")+
  theme(legend.position = "none")


piPCT.Init.rawPlot<-  
  piDat %>% 
  ggplot(aes(x=log(Init),y=log(PIpct),color=Species))+
  geom_point()+
  geom_smooth(method="lm",se=FALSE,color="black")+
  facet_grid(Species~BA.Target) +
  ylab("log(% BA increase)")+
  xlab("log(Tree BA in 1992, m²)")+
  theme(legend.position="none")


# fixed effects model with species pooled, using PBAI
fitBA<-
  piDat %>% 
  lmer(log(PI)~BA.Target:log(Init):Species+(1|Plot),data=.)

# fixed effects model with species pooled, using PBAIpct
fitBApct<-
  piDat %>% 
  lmer(log(PIpct)~BA.Target:log(Init):Species+(1|Plot),data=.)

# Create figure showing marginal means from model
fitBA.plot<-
  ggpredict(fitBA,terms=c("Init [exp]","Species","BA.Target")) %>% 
  dplyr::rename(Species=group) %>% 
  ggplot(aes(x,predicted,color=Species))+
  geom_line()+
  facet_wrap(~facet)+
  ylab("Predicted 27-year basal area increment (m²)")+
  xlab("Tree BA in 1992 (m²)")+
  theme_bw()+
  theme(legend.position="bottom")
  

# Create figure showing marginal means from model
fitBApct.plot<-
  ggpredict(fitBApct,terms=c("Init [exp]","Species","BA.Target")) %>% 
  dplyr::rename(Species=group) %>% 
  ggplot(aes(x,predicted,color=Species))+
  geom_line()+
  facet_wrap(~facet)+
  ylab("Predicted 27-year basal area % increase")+
  xlab("Tree BA in 1992 (m²)")+
  theme(legend.position="bottom")

  


# Captions
appNums(name="piInitRaw",display=FALSE)
appNums(name="piPCTInitRaw",display=FALSE)
figNums(name="fitBA.plot",display=FALSE)
figNums(name="fitBApct.plot",display=FALSE)

```

A comparison of tree-level 1992-2019 basal area increment to tree size at the time of treatment showed that basal area increment over 27 years increased with tree size, and that this relationship varied between species and among treatment units (`r appNums("piInitRaw",display="cite")`).  A linear mixed effects model using 
`r nrow(piDat)`
 trees (`r nrow(filter(piDat,Species=="Sx"))`
spruce, 
`r nrow(filter(piDat,Species=="Bl"))` fir) confirmed that slopes and intercepts varied with species and residual basal area (p<0.001 for all interactions).  This model explained 
`r round(r.squaredGLMM(fitBA)[1]*100,1)`
% variation (marginal R^2^) in diameter increment over the 27 years of the study, and showed that diameter increment increased with initial tree size, and increment was higher in the treatment units with basal area removed, compared to the control, and that spruce trees had higher basal area increment than fir (`r figNums("fitBA.plot",display="cite")`).  A similar model predicting basal area increment as a percentage of tree size at the time of treatment showed that smaller trees grew proportionally more than larger trees, with a strong negative exponential decrease with initial tree size (`r appNums("piPCTInitRaw",display="cite")` and `r figNums("fitBApct.plot",display="cite")`), however, the model fit was relatively poorer, explaining 
`r round(r.squaredGLMM(fitBApct)[1]*100,1)`
% of variation in % basal area increase.  

```{r tree level time lag response}
treeList<- # assign variable
  dat %>% 
  filter(TreeID!="New") %>% #remove new trees
  mutate(TreeID=paste(Plot,TreeID,sep="-")) %>% # create unique treeID
  filter(Species %in% c("Sx","Bl")) %>% # filter birch and fdi out of dataset
  filter(Status=="Live") %>% # filter for live trees
  group_by(TreeID) %>% 
  summarise(N=n()) %>% 
  filter(N==5) %>% #filter for trees with 5 measurements
  pull(TreeID)

# derive mean annual increment by period

piDat<-
  dat %>% 
  mutate(TreeID=paste(Plot,TreeID,sep="-")) %>% # create unique treeID
  filter(TreeID %in% treeList) %>% 
   left_join(plotDat,by="Plot") %>% 
  mutate(BA=(DBH/2/100)^2*pi) %>% # convert DBH to basal area
  dplyr::select(BA.Target,Plot,TreeID,Species,Year,val=BA) %>% 
  pivot_wider(names_from=Year,values_from=val) %>% 
  mutate(BA.Target=paste("TU:",BA.Target,sep="")) %>%  # create facet column
  
  # Create growth columns
  mutate(`2019`=(`2019`-`2009`)/11) %>% # divide by 11 to get annual increment
  mutate(`2009`=(`2009`-`1997`)/11) %>% # divide by 11 to get annual increment
  mutate(`1997`=(`1997`-`1994`)/3) %>% # divide by 3 to get annual increment
  mutate(`1994`=(`1994`-`1992`)/3) %>% # divide by 3 to get annual increment
  mutate(`Init`=`1992`) %>% # create initial size column
  pivot_longer(cols=c(`1992`,`1994`,`1997`,`2009`,`2019`),values_to="Inc",names_to="Year") %>% 
  filter(Year!=1992) %>% 
  filter(Inc>0) %>% # need to remove any trees with increment of 0- %>% 
  mutate(initClass=cut(Init,breaks=seq(from=7.5,to=90,by=20))) %>% 
  mutate(incPCT=Inc/Init*100) 
 

# Raw plots
baAnn.raw.plot<-
  # Plot boxplot of increment by year
  piDat %>% 
  ggplot(aes(x=Year,y=Inc,color=BA.Target))+
  geom_boxplot()+
  facet_grid(Species~BA.Target)+
  xlab("Measurement year")+
  ylab("Annualized basal area increment (m²)")+
  theme(legend.position = "none")+
  theme(legend.position = "none")


# Fit lmer
# fixed effects model
fitBA.Ann<-
  piDat %>% 
  lmer(log(Inc)~Year+Species+BA.Target+ (1|Plot/TreeID) ,data=.)
 
 # Create figure showing marginal means from model
fitBA.Ann.plot<-
  ggpredict(fitBA.Ann,terms=c("Year","Species","BA.Target"))  %>%
  plot()+
  theme_bw()+
  ylab("Predicated annualized basal area increment (m²)")+
  xlab("Measurement year")+
  ggtitle("")+
  theme(legend.position = "bottom")
  
# Captions 
appNums(name="baAnnRaw",display=FALSE)
figNums(name="fitBA.Ann.plot",display=FALSE)

```

To detect differences in growth rates over the 27-year period of this study, we compared growth rates between the four measurement periods, by species and treatment unit (`r appNums(name="baAnnRaw",display="cite")`).  Growth rates were lowest in the three years immediately after treatment, and increased over the subsequent two measurement periods (1994-1997 and 1997-2009), before decreasing again in the last measurement period (2009-2019).  This temporal pattern appeared consistent between species and among treatment units; as well, spruce trees had higher growth rates than fir over all periods and treatment units, and growth rates were higher in the high-removal treatment unit, compared to the low-removal treatment and control units.  A linear mixed effects model with species, measurement year and treatment unit as fixed effects (not shown) explained `r MuMIn::r.squaredGLMM(fitBA.Ann)[1] %>% round(3)*100`% variation (marginal R^2^) in log-transformed basal area increment (m^2^ at breast height) over different periods (`r figNums("fitBA.Ann.plot",display="cite")`).

### Tree density
```{r sph by diam class species and time}

# need to create  a list of plots with five measurements
plotDenom<-
  dat %>% 
  left_join(plotDat,by="Plot") %>% # join with plot data
  group_by(BA.Target,Year,Plot) %>% 
  summarise(Num.Plots=n()) %>% 
  ungroup() %>% 
  dplyr::select(BA.Target:Plot) %>% 
  group_by(BA.Target,Year) %>% 
  summarise(Num.Plots=n())
 

# PLOTS
# Raw plot - examine SPH in each plot to detect where mortality occurred
# sphPlot.raw<-
#   dat %>% 
#   left_join(plotDat,by="Plot") %>% # join with plot data
#   filter(Status=="Live") %>% # filter for live trees only
#   group_by(BA.Target,Species,Plot,Year,DBH.class) %>% 
#   summarise(SPH=n()*20)  %>% 
#   filter(Species %in% c("Bl","Sx")) %>% # remove Fdi and Ep
#   ggplot()+
#   aes(x=DBH.class,y=SPH,group=Species,color=Species)+
#   geom_point()+
#   facet_grid(Plot~Year)+
#   theme(axis.text.x = element_text(angle = 90, hjust = 1),
#         legend.position="bottom")+
#   xlab("DBH Class (cm)")
# 
# appNums(name="sphRawPlot",display=FALSE)

# 1. SPH by diameter class and species for 1992 and 2019 periods
sphPlot1<-
  dat %>% 
  filter(Year %in% c(1992,2019)) %>% # Select for two time periods
    filter(Species %in% c("Bl","Sx")) %>% 
  left_join(plotDat,by="Plot") %>% # join with plot data
  group_by(BA.Target,Year,Species,DBH.class) %>% 
  summarise(SPH.Sum=n()*20) %>% # plot multiplier
  left_join(plotDenom,by=c("BA.Target","Year")) %>% 
  mutate(SPH=SPH.Sum/Num.Plots) %>% 
  
  ggplot()+
  aes(x=DBH.class,y=SPH,group=Species,fill=Species,color=Species)+
  geom_point()+
  geom_path()+
    # geom_density(alpha=0.4)+
  facet_grid(Year~BA.Target)+
  theme(axis.text.x = element_text(angle = 90, hjust = 1,vjust=0.5),
        legend.position = "bottom")+
  xlab("DBH Class (cm)")
  
  figNums(name="sphSpeciesPlot",display=FALSE)
```
  
```{r plot pct change in SPH by diam class between 92 and 19}  

# % change in diameter class between 1992 and 2019 time periods by species
 sphPCTPlot<- 
  dat %>% 
  filter(Year %in% c(1992,2019)) %>% 
  filter(Status=="Live") %>% 
  filter(Species %in% c("Bl","Sx")) %>% 
  group_by(Plot,Species,Year,DBH.class) %>% 
  summarise(SPH.Total=n()) %>% 
  pivot_wider(names_from="Year",values_from="SPH.Total") %>% 
  mutate(Pct.Change=(`2019`-`1992`)/`1992`*100) %>% 
  mutate(Pct.Change=round(Pct.Change,3)) %>%
  drop_na(Pct.Change) %>% 
  left_join(plotDat,by="Plot") %>% # join with plot data
  
  # Plotting
  ggplot()+
  aes(x=DBH.class,y=Pct.Change,fill=Species)+
  geom_boxplot()+
  geom_hline(yintercept=0, linetype="dashed", color="darkgrey")+
  facet_grid(Species~BA.Target)+
  theme(axis.text.x = element_text(angle = 90, hjust = 1,vjust=0.5),
        legend.position="bottom")+
  xlab("DBH Class (cm)")+
  ylab("% change in SPH between 1992 and 2019")
  

  figNums(name="sphPCTPlot",display=FALSE)


# ggsave(filename="baDiamClass.png")


```

Mean plot tree density by diameter class diagrams showed that across all treatment levels, subalpine fir comprised the majority of stems in the smaller diameter classes, both in the year after treatment, and in 2019 (`r figNums("sphSpeciesPlot",display="cite")`). The diameter class distribution of fir in all treatment units was negative exponential.  Mean spruce density was lower than fir, with a relatively flatter diameter distribution.  Within the high-removal treatment unit, fir density increased mostly in the smaller diameter classes between 1992 and 2019; in the low-removal treatment unit, fir density increased most in trees between 12.5 to 27.5cm DBH; and in the control treatment unit, fir density increased mostly in trees above 22.5cm DBH ( `r figNums("sphPCTPlot",display="cite")`).  Spruce tree density increased less than fir, with the exception of an increase of over 250% in SPH in the smallest diameter class in the light-removal treatment unit.

## Stand-level changes

### Volume estimates


### Height-diameter models

```{r height diameter raw plot}

heightDiamRaw.plot<-
  dat %>% 
    filter(Species %in% c("Bl","Sx")) %>% # filter for Bl and Sx for now
    filter(Status=="Live") %>% # filter for live trees
    filter(is.na(DBT)) %>% # filter for trees with no broken tops
    drop_na(Height) %>% # remove trees where height was not measured
    
    # Plotting
  ggplot()+
  aes(x=DBH,y=Height,fill=Species)+
  geom_point()+
  facet_grid(Year~Species)+
  theme(legend.position = "none")+
  ylab("Height (m)")+
  xlab("DBH (cm)")+
  geom_smooth(formula = y~log(x),method="lm",se=FALSE)

# Fit model
htDiamFit<- 
  dat %>% 
    filter(Species %in% c("Bl","Sx")) %>% # filter for Bl and Sx for now
    filter(Status=="Live") %>% # filter for live trees
    filter(is.na(DBT)) %>% # filter for trees with no broken tops
    drop_na(Height) %>% # remove trees where height was not measured
  mutate(TreeID=paste(Plot,TreeID,sep="-")) %>% # create tree ID column
  lmer(log(Height)~log(DBH)+(1|Plot/TreeID),data=.)

# Apply fit model to data and create new height column
dat<-
  dat %>% 
  mutate(Height.Pred=coalesce(Height,exp(fixef(htDiamFit)[1]+fixef(htDiamFit)[2]*log(DBH))))

# Height model fit plot
htModelFit.plot<-
  dat %>% 
  ggplot(aes(x=Height,y=Height.Pred))+
  geom_point()+
  xlim(0,40)+
  ylim(0,40)+
  geom_smooth(method="lm",se=F)+
  ylab("Predicted height (m) from diameter-height model")+
  xlab("Measured height (m)")

# create captions
appNums("heightDiamRawPlot",display="FALSE")
appNums("htModelFit",display="FALSE")

```

Tree heights had a positive nonlinear relationship with diameter, for both species and across all time periods (`r appNums("heightDiamRawPlot",display="cite")`).  A comparison of height-diameter models showed that intercepts and slopes of log-transformed heights did not vary significantly (p<0.05) between species or time periods (not shown), therefore a single height-diameter linear mixed-effects model was developed using `r dat %>% filter(Species %in% c("Bl","Sx")) %>% filter(Status=="Live") %>% filter(is.na(DBT)) %>% drop_na(Height) %>% nrow()` tree height-diameter observations in the dataset, with log-transformed diameter as the fixed effect, and tree nested within plot as random effect. This model explained `r round(MuMIn::r.squaredGLMM(htDiamFit)[1]*100,1)`% of variation in log-transformed heights, with an intercept of `r round(fixef(htDiamFit)[1],3)` and slope coefficient of  `r round(fixef(htDiamFit)[2],3)` * log(DBH).  Residual and predicted vs actual height plots were assessed to ensure goodness of fit (`appNums("htModelFit",display="cite")`).  The model slightly overestimated tree heights in shorter trees, and underestimated tree heights in taller trees.  This model was applied to predict heights in trees without height measurements, and tree-volume estimates generated as per Nigh [-@Nigh2016].

```{r hardcode volume coefficients per Nigh}

volCoef<-
  
  ## TOTAL VOLUME
  #  Subalpine fir 
  data.frame(Species="Bl",VolType="total",b0=-9.79,b1=1.813,b2=1.033) %>% 
  
  # Douglas-fir
  add_row(Species="Fd",VolType="total",b0=-10.19,b1=1.73,b2=1.206) %>% 
  
  # Add spruce
  add_row(Species="Sx",VolType="total",b0=-10.024,b1= 1.801,b2= 1.107) %>% 
  
  ## MERCHANTABLE VOLUME
  # Subalpine fir
  add_row(Species="Bl",VolType="merch",b0=-9.980,b1= 1.792,b2= 1.102) %>% 
  
  # Douglas-fir
  add_row(Species="Fd",VolType="merch",b0=-10.503,b1= 1.724,b2= 1.296) %>% 
  
  # Spruce
  add_row(Species="Sx",VolType="merch",b0=-10.280,b1= 1.769,b2= 1.206 ) %>% 
  
  mutate(BGC.Zone="SBS") %>% 
  
  # convert species to factor
  mutate(Species=factor(Species)) %>% 
  dplyr::select(Species,BGC.Zone,everything())

```



```{r generate volume estimates}

dat<-
  
  # Total volumes
  dat %>% 
  left_join(filter(volCoef,VolType=="total"),by="Species") %>% 
  mutate(VolTot=exp(1)^b0*DBH^b1*Height.Pred^b2) %>% 
  dplyr::select(-c(BGC.Zone,VolType,b0,b1,b2)) %>% 

  # Merchantable volume
  left_join(filter(volCoef,VolType=="merch"),by="Species") %>% 
  mutate(VolMerch=exp(1)^b0*DBH^b1*Height.Pred^b2) %>% 
  dplyr::select(-c(BGC.Zone,VolType,b0,b1,b2)) %>% 
  
  # basal area
  mutate(BA=(DBH/100/2)^2*pi) 

# Create stand data
standDat<-
  dat %>% 
  group_by(Plot,Year) %>% 
  summarise(VolTot=sum(VolTot,na.rm=T)*20, # notice that all variables are by hectare
            VolMerch=sum(VolMerch,na.rm=T)*20,
            BA=sum(BA,na.rm=T)*20,
            k=n()*20) %>% 
  mutate(QMD=sqrt(BA/(k*0.0000785))) %>% 
  left_join(plotDat,by="Plot") %>%  # joinwith plot Data
   mutate(TU=paste("TU",BA.Target,sep=":"))  # create a TU column for plotting


```

```{r boxplot stand volumes by year}

volPlot<-
  standDat %>% 
  # plot
  ggplot()+
  aes(x=Year,y=BA,fill=BA.Target)+
  geom_boxplot()+
  facet_wrap(~TU)+
  theme(legend.position="none")+
  ylab("Mean plot volume (m/hectare)")

volFit<-
  standDat %>% 
  lm(VolTot~BA.Target*Year,data=.)



```

  


# Discussion


# Tables

##### page break

# Figures

```{r plot marginal means DBH increment by tree size}
fitBA.plot
```

`r figNums("fitBA.plot",caption=paste("Predicted basal area (m^2^ at breast height) increment by tree basal area at time of treatment, species and treatment unit.  Interactions between initial tree size, treatment unit and species were significant (p<0.001) in a linear model explaining ", MuMIn::r.squaredGLMM(fitBA)[1] %>% round(3)*100, "% variation in basal area increment (not shown).  Predictions are back-transformed to original response scale.",sep=""))`


```{r plot marginal means DBH increment pct}

fitBApct.plot

```

`r figNums("fitBApct.plot",caption=paste("Predicted basal area (m^2^ at breast height) increment (cm), as a percentage of tree basal area at the time of treatment, by initial tree size.  Interactions between initial tree size and (i) treatment unit and (ii) species factors were significant (p<0.001) in a linear model explaining ", MuMIn::r.squaredGLMM(fitBApct)[1] %>% round(3)*100, "% variation in basal area increment (not shown). Predictions are back-transformed to original response scale.",sep=""))`

##### page break

```{r plot marginal means BA increment by year}

fitBA.Ann.plot


```

`r figNums("fitBA.Ann.plot",caption=paste("Predicted annualized basal area increment (m^2^ at breast height) over four periods from a linear mixed effects model explaining ", MuMIn::r.squaredGLMM(fitBA.Ann)[1] %>% round(3)*100, "% variation in log-transformed basal area increment with period, treatment unit and species as fixed effects (p<0.001 for all fixed effects, now shown). Basal area increment are average for growing seasons within each period.  For example, values at x-axis value of 1994 are mean for three growing seasons (between 1992 and 1994).  Predictions are back-transformed to original response scale.  Error bars represent 95% confidence intervals.",sep=""))`

##### page break

```{r plot density by diameter class, fig.width=6}
sphPlot1

```

`r figNums(name="sphSpeciesPlot",caption="Mean density of stems per hectare (SPH) by diameter class and species, faceted by treatment unit and two measurement periods.  Lowest value is included in each diameter class, highest value is not.")`

##### page break

```{r plot density change PCT by diameter class, fig.width=6}
sphPCTPlot

```

`r figNums(name="sphSpeciesPlot",caption="Percentage change between 1992 and 2019 in stems per hectare (SPH) by diameter class, faceted by treatment unit and species.   tsphPCTPlotwo measurement periods.  Lowest value is included in each diameter class, highest value is not.")`

##### page break

# Appendices
```{r plot raw PBAI by species and TU}

pi.Init.rawPlot


```

`r appNums("piInitRaw",caption="Log-transformed basal area increment (m²) over 1992-2019 period by log-transformed tree size (basal area, m²) at the time of treatment, faceted by treatment unit and species.  Both axes have been log-transformed.  Linear regression lines added to emphasize slope.")`

##### page break

```{r plot raw PBAI as pct initial tree size by species and TU}

piPCT.Init.rawPlot


```

`r appNums("piPCTInitRaw",caption="Log-transformed basal area increment (m²), as a percentage of log-transformed initial tree size, over 1992-2019 period by tree size (basal area, m²) at the time of treatment, faceted by treatment unit and species.  Both axes have been log-transformed.  Linear regression lines added to emphasize slope.")`

##### page break

```{r plot raw basal area increment data by year}
baAnn.raw.plot

```


`r appNums("baAnnRaw",caption="Annualized basal area increment (m² at breast height) over four measurement periods. Boxplots show dispersion of mean growing season tree-level basal area increment within each period.  Data are faceted by species and treatment unit.")`

##### page break

```{r plot height to diameter models by species and year, fig.asp=1.2, fig.width=6}

heightDiamRaw.plot

```

`r appNums("heightDiamRawPlot",caption="Height and diameter comparisons for 870 tree measurements, faceted by species and measurement year.")`

##### page break
```{r plot diam to height model fit}

htModelFit.plot
```

`r appNums("htModelFit",caption="Predicted height against measured height for 870 tree measurements.  Outlier represents a tree with a broken top.")`


